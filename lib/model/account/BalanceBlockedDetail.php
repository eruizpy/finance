<?php


/**
 * Skeleton subclass for representing a row from the 'balance_block_detail' table.
 *
 * 
 *
 * This class was autogenerated by Propel 1.4.2 on:
 *
 * Wed Aug 17 06:56:25 2011
 *
 * You should add additional methods to this class to meet the
 * application requirements.  This class will only be generated as
 * long as it does not already exist in the output directory.
 *
 * @package    lib.model.account
 */
class BalanceBlockedDetail extends BaseBalanceBlockedDetail 
{
  /**
   * Save this object
   * 
   * @param PropelPDO $con 
   */
  public function save(PropelPDO $con = null) 
  {
    if($this->isNew()){
      $this->setBlockedAt(time());
    }
    parent::save($con);
  }
  
  /**
   * Post insert
   * 
   * @param PropelPDO $con 
   */
  public function postInsert(PropelPDO $con = null)
  {
    $this->getAccount()->blockBalance($this->getAmount(), $con);
    parent::postInsert($con);
  }
  
  /**
   * Unblock the amount this object
   * 
   * @param PropelPDO $con 
   */
  public function unblock(PropelPDO $con = null)
  {
    if($con == null){
      $con = Propel::getConnection(AccountPeer::DATABASE_NAME, Propel::CONNECTION_WRITE);
    }
    
    $con->beginTransaction();
    
    try{ 
      
      $this->getAccount()->unblockBalance($this->getAmount(), $con);
      
      $this->delete();

      $con->commit();
      
    }catch (Exception $e){
      $con->rollBack();
      throw $e;
    }
  }
} // BalanceBlockDetail
